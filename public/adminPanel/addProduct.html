<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Product - Admin Panel | THE RAS</title>
  <link rel="stylesheet" href="../css/admin.css">
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h2>THE RAS</h2>
      <p class="role-badge">ADMIN</p>
    </div>

    <nav class="sidebar-menu">
      <a href="/admin">ğŸ  Dashboard</a>
      <a class="active" href="#">â• Add Product</a>
      <a href="/admin/manageProduct">ğŸ› Manage Products</a>
      <a href="/admin/categories">ğŸ“‚ Manage Categories</a>
      <a href="/admin/orders">ğŸ“„ Manage Orders</a>
      <a href="#">ğŸ‘¤ Manage Users</a>
    </nav>

    <button id="logoutBtn" class="logout-btn">Logout</button>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <header class="admin-header">
      <h1>Add New Product</h1>
      <p>Fill product details and publish to the store ğŸš€</p>
    </header>

    <form id="productForm" class="product-form">

      <div class="form-group">
        <label>Product Title *</label>
        <input type="text" id="title" required>
      </div>

      <div class="form-group">
        <label>Description *</label>
        <textarea id="description" required></textarea>
      </div>

      <div class="form-group">
        <label>Category *</label>
        <select id="category" required>
          <option value="">Loading...</option>
        </select>
      </div>

      <div class="form-group-inline">
        <div>
          <label>Price *</label>
          <input type="number" id="price" required>
        </div>

        <div>
          <label>Stock *</label>
          <input type="number" id="stock" required>
        </div>
      </div>

      <div class="form-group">
        <label>Image URL *</label>
        <input type="text" id="image" required placeholder="https://example.com/product.jpg">
      </div>

      <button type="submit" class="btn-primary full-btn">Add Product</button>
    </form>
  </main>


<script src="../js/api.js"></script>
<script>

  // Protect Page
  async function protectAdminPage() {
    const user = await getCurrentUser();
    if (!user || user.role !== "admin") {
      alert("Unauthorized access!");
      window.location.href = "/";
    }
  }

  protectAdminPage();


  // Load Categories from backend
  async function loadCategories() {
    try {

      const categories = await getCategories()

      const select = document.getElementById("category");
      select.innerHTML = categories.map(c => `<option value="${c.name}">${c.name}</option>`).join('');

    } catch (err) {
      alert("Error loading categories");
    }
  }

  loadCategories();


  // Submit Form
  document.getElementById("productForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const product = {
      title: document.getElementById("title").value,
      description: document.getElementById("description").value,
      category: document.getElementById("category").value,
      price: Number(document.getElementById("price").value),
      stock: Number(document.getElementById("stock").value),
      image: document.getElementById("image").value,
    };

    const response = await createProduct(product);

    if (response) {
      alert("Product added successfully!");
      document.getElementById("productForm").reset();
    } else {
      alert("Error adding product");
    }
  });

  document.getElementById("logoutBtn").addEventListener("click", logout);

</script>
</body>
</html>
